:root{
  --ao3h-accent:        #c62828;
  --ao3h-fg:            #0b1220;
  --ao3h-fg-dim:        #445069;

  --ao3h-glass-bg:      rgba(255,255,255,.55);
  --ao3h-glass-stroke:  rgba(255,255,255,.45);
  --ao3h-glass-shadow:  0 12px 40px rgba(2,6,23,.22);

  --ao3h-item-bg:       rgba(255,255,255,.75);
  --ao3h-item-hover:    rgba(255,255,255,.54);

  --ao3h-group-fg:      #a12020;

  --ao3h-switch-on:     #0bbf6a;
  --ao3h-switch-off:    rgba(15,23,42,.35);

  --ao3h-radius-lg:     16px;
  --ao3h-radius-md:     12px;

  --ao3h-pad-y:         .55em;
  --ao3h-pad-x:         .9em;
  --ao3h-gap:           .75rem;

  --ao3h-focus-ring:    0 0 0 3px rgba(198,40,40,.25);
}

.ao3h-menu{
  color: var(--ao3h-fg) !important;
  max-width: 280px;
  padding: .5rem .5rem;
  box-shadow:
    0 0 0 1px rgba(255,255,255,.35),
    0 6px 18px rgba(0,0,0,.25),
    0 18px 40px rgba(0,0,0,.15);
}

/* Scroll support */
.ao3h-menu {
  max-height: 70vh;
  overflow-y: auto;
  overscroll-behavior: contain;
  scrollbar-width: thin;
}
.ao3h-menu::-webkit-scrollbar { width: 6px; }
.ao3h-menu::-webkit-scrollbar-thumb {
  background: rgba(0,0,0,0.25);
  border-radius: 4px;
}
.ao3h-menu::after {
  content: "";
  position: sticky; bottom: 0; left: 0; right: 0; height: 16px;
  pointer-events: none;
  background: linear-gradient(to bottom, transparent, rgba(0,0,0,0.1));
}

#header .menu > li{ margin:0 !important; }

.ao3h-menu a{
  display:flex; align-items:center; justify-content:space-between;
  gap: var(--ao3h-gap);
  padding: .5rem .75rem;
  font-size: 13px; line-height: 1.15;
  color: inherit !important; text-decoration: none; white-space: nowrap;
  background: var(--ao3h-item-bg);
  border-radius: var(--ao3h-radius-md);
  transition: background .18s ease, transform .12s ease, box-shadow .18s ease;
  box-shadow: 0 1px 0 rgba(2,6,23,.05);
  margin: 6px 4px;
}
.ao3h-menu a:hover{
  background: var(--ao3h-item-hover) !important;
  transform: translateY(-1px);
  box-shadow: 0 6px 18px rgba(2,6,23,.10);
}
.ao3h-menu a:focus{
  outline: none;
  box-shadow: 0 0 0 0 rgba(0,0,0,0), var(--ao3h-focus-ring);
}
.ao3h-label{ flex:1 1 auto; min-width:0; }
.ao3h-kbd{ font-size:12px; color: var(--ao3h-fg-dim); margin-left:.75rem; }
.ao3h-state{ width:1.2em; text-align:center; }

/* Module pills */
.ao3h-menu a[data-flag]{
  background: var(--ao3h-item-bg) !important;
  color: var(--ao3h-fg) !important;
  text-transform: none;
  font-size: 13px; font-weight: 600;
  border-radius: var(--ao3h-radius-md);
  margin: 6px 4px; padding: .5rem .75rem;
  box-shadow: 0 1px 3px rgba(0,0,0,.08);
}
.ao3h-menu a[data-flag]:hover{ background: var(--ao3h-item-hover) !important; }

/* Group headers */
.ao3h-menu > li > a{
  background: transparent !important;
  color: var(--ao3h-group-fg) !important;
  text-transform: uppercase; letter-spacing: .25px;
  font-size: 12px !important; font-weight: 700;
  margin: 4px 6px 2px; padding: .35rem .5rem;
  border: 0; /* ← corrigé (avant: border: 6px;) */
  box-shadow: none !important;
}
.ao3h-submenu > li > a .ao3h-caret{ color: inherit; opacity: .9; }
.ao3h-submenu > li > a:hover{ background: rgba(0,0,0,.05) !important; }

.ao3h-menu li{ position: static; }
.ao3h-submenu{
  position: static !important;
  left:auto !important; right:auto !important; top:auto !important;
  margin:0 !important; padding:0 !important; min-width:0 !important;
  list-style:none; display:none !important; visibility:visible !important;
  transform:none !important; z-index:auto;
}
.ao3h-submenu.open{ display: contents !important; }
.ao3h-submenu.dropdown-menu{
  position: static !important; left:auto !important; right:auto !important; top:auto !important;
  margin:0 !important; padding:0 !important; min-width:0 !important;
  border:0 !important; background:transparent !important; box-shadow:none !important; transform:none !important;
}
.ao3h-submenu a{
  display:flex; align-items:center; justify-content:space-between;
  gap: var(--ao3h-gap); padding:.5rem .75rem;
}

.ao3h-divider{ display:none !important; }

.ao3h-switch{
  flex:0 0 42px; width:42px; height:22px; margin-left:.5rem;
  border-radius: 999px;
  background: var(--ao3h-switch-off);
  position: relative;
  transition: background .18s ease;
  box-shadow: inset 0 0 0 1px rgba(2,6,23,.12);
}
.ao3h-switch::after{
  content:""; position:absolute; top:2px; left:2px;
  width:18px; height:18px; border-radius: 50%;
  background: #fff; box-shadow: 0 1px 2px rgba(2,6,23,.25);
  transition: left .18s ease;
}
a.ao3h-on .ao3h-switch{ background: var(--ao3h-switch-on); box-shadow: inset 0 0 0 1px rgba(2,6,23,.1); }
a.ao3h-on .ao3h-switch::after{ left: 22px; }

.ao3h-navlink{
  color:#fff; text-decoration:none;
  padding: var(--ao3h-pad-y) var(--ao3h-pad-x);
  display:inline-block; transition: background-color .2s, transform .12s;
  border-radius: 10px;
}
.ao3h-root:hover .ao3h-navlink,
.ao3h-root:focus-within .ao3h-navlink,
.ao3h-root.open .ao3h-navlink{
  background: rgba(255,255,255,.18);
  transform: translateY(-1px);
}

/* Dialog skin (reused) */
dialog.ao3h-dialog::backdrop{ background: rgba(2,6,23,.45); }
dialog.ao3h-dialog{
  border:1px solid rgba(255,255,255,.35);
  border-radius: 14px; padding: 16px 16px 14px;
  width:360px; max-width:90vw;
  background: rgba(255,255,255,.65);
  -webkit-backdrop-filter: blur(12px) saturate(130%);
  backdrop-filter: blur(12px) saturate(130%);
  box-shadow: var(--ao3h-glass-shadow);
  color: var(--ao3h-fg);
}

/* Dark mode */
@media (prefers-color-scheme: dark){
  .ao3h-menu{
    border: 2px solid rgba(255,255,255,.35) !important;
    box-shadow:
      0 0 0 1px rgba(0,0,0,.6),
      0 8px 20px rgba(0,0,0,.6),
      0 18px 40px rgba(255,255,255,.05);
  }
  .ao3h-menu a[data-flag]:hover,
  .ao3h-submenu > li > a:hover{
    background: rgba(255,255,255,.08) !important;
  }
  dialog.ao3h-dialog{
    background: rgba(16,21,38,.72);
    color: var(--ao3h-fg);
  }
}

/* ──────────────────────────────────────────────────────────────────────────
   AO3H • Menu Grouper (sous-menus fermés par défaut + toggles identiques)
   ────────────────────────────────────────────────────────────────────── */
ul.ao3h-menu > li[data-ao3h-grouped-original="1"] { display: none !important; }

ul.ao3h-submenu{
  list-style:none; margin:0; padding:0;
  display:none !important;
  position:static !important; left:auto !important; right:auto !important; top:auto !important;
  background:transparent !important; border:0 !important; box-shadow:none !important; transform:none !important;
}
ul.ao3h-submenu.open{ display:block !important; }

ul.ao3h-submenu a{
  display:flex !important; align-items:center !important; justify-content:space-between !important;
  gap: var(--ao3h-gap, .75rem) !important; padding:.35rem .75rem !important;
  line-height:1.2 !important; white-space:nowrap !important;
}
ul.ao3h-submenu a .ao3h-label{ flex:1 1 auto !important; min-width:0 !important; font-size:12px !important; }

ul.ao3h-submenu a .ao3h-switch{
  flex:0 0 40px !important; width:40px !important; height:12px !important; margin-left:.5rem !important;
  border-radius:12px !important; background: var(--ao3h-switch-off, #aab1bd) !important;
  position:relative !important; box-shadow: inset 2px 2px rgba(0,0,0,.2) !important;
  transition: background .25s ease !important;
}
ul.ao3h-submenu a .ao3h-switch::after{
  content:""; position:absolute !important; top:-2px !important; left:-2px !important;
  width:14px !important; height:14px !important; border-radius:20px !important;
  background:#ddd !important; border:1px solid rgba(0,0,0,.1) !important;
  box-shadow: inset 2px 2px rgba(255,255,255,.6), inset -1px -1px rgba(0,0,0,.1) !important;
  transition:left .25s ease !important;
}
ul.ao3h-submenu a.ao3h-on .ao3h-switch{ background: var(--ao3h-switch-on, #22c55e) !important; }
ul.ao3h-submenu a.ao3h-on .ao3h-switch::after{ left: calc(100% - 14px) !important; }

.ao3h-caret{ transition: transform .15s ease; }
li > a[aria-expanded="true"] .ao3h-caret{ transform: rotate(180deg); }
